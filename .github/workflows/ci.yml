name: CI
on: [push]
jobs:
    phpcs:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v2
            - run: bin/ci/phpcs

    phpstan:
        runs-on: ubuntu-latest
        strategy:
            matrix:
                php: [--php=7.4, --php=8.0, --php=8.1]
        steps:
            - uses: actions/checkout@v2
            - uses: ./.github/actions/ci-env
            - run: bin/ci/phpstan ${{ matrix.php }}

    phpdd:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v2
            - uses: ./.github/actions/ci-env
            - run: bin/ci/phpdd

    composer-normalize:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v2
            - run: bin/ci/composer-normalize

    composer-require-checker:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v2
            - uses: ./.github/actions/ci-env
            - run: bin/ci/composer-require-checker

    composer-validate:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v2
            - run: bin/ci/composer-validate

    shellcheck:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v2
            - run: bin/ci/shellcheck

    unused-scanner:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v2
            - run: bin/ci/unused-scanner

    phpunit-php-7-4:
        runs-on: ubuntu-latest
        strategy:
            matrix:
                symfony: [--symfony=5.0, --symfony=5.1, --symfony=5.2, --symfony=5.3, --symfony=5.4]
        steps:
            - uses: actions/checkout@v2
            - uses: ./.github/actions/ci-env
            - run: bin/ci/phpunit --php=7.4 ${{ matrix.symfony }}

    phpunit-php-8-0:
        runs-on: ubuntu-latest
        strategy:
            matrix:
                symfony: [--symfony=5.0, --symfony=5.1, --symfony=5.2, --symfony=5.3, --symfony=5.4, --symfony=6.0]
        steps:
            - uses: actions/checkout@v2
            - uses: ./.github/actions/ci-env
            - run: bin/ci/phpunit --php=8.0 ${{ matrix.symfony }}

    phpunit-php-8-1:
        runs-on: ubuntu-latest
        strategy:
            matrix:
                symfony: [--symfony=5.0, --symfony=5.1, --symfony=5.2, --symfony=5.3, --symfony=5.4, --symfony=6.0]
        steps:
            - uses: actions/checkout@v2
            - uses: ./.github/actions/ci-env
            - run: bin/ci/phpunit --php=8.1 ${{ matrix.symfony }}

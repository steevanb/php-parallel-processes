name: CI
on: [push]
jobs:
    phpcs:
        runs-on: ubuntu-latest
        container:
            image: steevanb/php-ci:latest
        steps:
            - uses: actions/checkout@v2
            - run: bin/ci/phpcs

    phpstan:
        runs-on: ubuntu-latest
        container:
            image: steevanb/php-ci:latest
        steps:
            - uses: actions/checkout@v2
            -
                name: Composer cache
                uses: actions/cache@v2
                with:
                    path: vendor
                    key: composer-${{ hashFiles('composer.json') }}
                    restore-keys: composer-${{ hashFiles('composer.json') }}
            - run: composer update
            - run: bin/ci/phpstan

    phpdd:
        runs-on: ubuntu-latest
        container:
            image: steevanb/php-ci:latest
        steps:
            - uses: actions/checkout@v2
            -
                name: Composer cache
                uses: actions/cache@v2
                with:
                    path: vendor
                    key: composer-${{ hashFiles('composer.json') }}
                    restore-keys: composer-${{ hashFiles('composer.json') }}
            - run: composer update
            - run: bin/ci/phpdd

    composer-require-checker:
        runs-on: ubuntu-latest
        container:
            image: steevanb/php-ci:latest
        steps:
            - uses: actions/checkout@v2
            -
                name: Composer cache
                uses: actions/cache@v2
                with:
                    path: vendor
                    key: composer-${{ hashFiles('composer.json') }}
                    restore-keys: composer-${{ hashFiles('composer.json') }}
            - run: composer update
            - run: bin/ci/composer-require-checker

    composer-validate:
        runs-on: ubuntu-latest
        container:
            image: steevanb/php-ci:latest
        steps:
            - uses: actions/checkout@v2
            - run: bin/ci/composer-validate

    phpunit-php-7-4:
        runs-on: ubuntu-latest
        container:
            image: steevanb/php-parallel-process:phpunit
        steps:
            - uses: actions/checkout@v2
            -
                name: Composer cache
                uses: actions/cache@v2
                with:
                    path: vendor
                    key: composer-${{ hashFiles('composer.json') }}
                    restore-keys: composer-${{ hashFiles('composer.json') }}
            - run: composer update
            - run: bin/ci/phpunit-php-7-4

    phpunit-php-8-0:
        runs-on: ubuntu-latest
        container:
            image: steevanb/php-parallel-process:phpunit
        steps:
            - uses: actions/checkout@v2
            -
                name: Composer cache
                uses: actions/cache@v2
                with:
                    path: vendor
                    key: composer-${{ hashFiles('composer.json') }}
                    restore-keys: composer-${{ hashFiles('composer.json') }}
            - run: composer update
            - run: bin/ci/phpunit-php-8-0

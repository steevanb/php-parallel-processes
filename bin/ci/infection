#!/usr/bin/env sh

set -eu

readonly rootDir="$(realpath "$(dirname "$(realpath "$0")")/../..")"
. "${rootDir}/bin/common.inc.sh"

if ! ${IS_IN_DOCKER}; then
    docker \
        run \
            --tty \
            ${DOCKER_INTERACTIVE_PARAMETER} \
            --volume "${rootDir}":/app \
            --user "$(id -u)":"$(id -g)" \
            --entrypoint bin/ci/"$(basename "${0}")" \
            --workdir /app \
            steevanb/php-parallel-process:ci \
            "${@}"
    exit 0
fi

XDEBUG_MODE=coverage \
    infection \
        --configuration=config/ci/infection.json \
        --threads=10 \
        --only-covered \
        --ansi \
        "${@}"

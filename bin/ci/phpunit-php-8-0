#!/usr/bin/env sh

set -eu

if type docker > /dev/null 2>&1; then
    readonly rootDir=$(realpath $(dirname $(realpath $0))/../..)

    docker \
        run \
            -it \
            --tty \
            --rm \
            --volume "${rootDir}":/app \
            --user $(id -u):$(id -g) \
            --entrypoint bin/ci/phpunit-php-8-0 \
            --workdir /app \
            steevanb/php-parallel-process:phpunit
else
    # If Docker image is steevanb/php-parallel-process:phpunit (bin/ci/phpunit-php-8-0)
    if type php8.0 > /dev/null 2>&1; then
        php8.0 vendor/bin/phpunit --configuration config/ci/phpunit.xml
    # If Docker image is steevanb/php-ci:latest (bin/ci/validate)
    else
        php vendor/bin/phpunit --configuration config/ci/phpunit.xml
    fi
fi
